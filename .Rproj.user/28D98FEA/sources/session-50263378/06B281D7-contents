---
title: "PM566 Lab 3"
author: "Chih-Chan Jessica Lan"
format: html
editor: visual
---

# Steps for Exploratory Data Analysis
```{r}
library(dplyr)
```

## Step 1: Read in data
```{r}
getwd()
met <- read.csv("../Lab3/met_all.gz")
```

## Step 2: Check the structure
```{r}
dim(met)
# First 6 rows
head(met)
# Last 6 rows
tail(met)
```
- How many columns, rows are there?
There are 30 columns and 2377343 columns in the data.

## Step 3: Look into the variables
```{r}
str(met)
```

## Step 4: Look into specific variables
```{r}
table(met$year)
table(met$day)
table(met$hour)
# Summary for Temperature
summary(met$temp)
# Summary for Elevation
summary(met$elev)
# Summary for Wind Speed
summary(met$wind.sp)
```

Modification of missing value
```{r}
met$elev[met$elev == 9999.0] <- NA
summary(met$elev)
```
- At what elevation is the highest weather station?
Ans: The highest value of elevation is 4113 meters.

```{r}
met <- met[met$temp>-40, ]
met2 <- met[order(met$temp), ]
head(met2)
```

## Step 5: Check the data
Check suspicious temp
```{r}
met$elev[which.min(met$temp)]
range(met$elev, na.rm = T)
```

```{r}
met <- met[met$temp>-15, ]
met2 <- met[order(met$temp), ]
head(met2)
```

Now dimension become 2377293*30

## Step 6: Calculate summary statistics
```{r}
elev <- met[met$elev == max(met$elev, na.rm = T), ]
summary(elev)
```

Looking at correlation between two variables
`use = "complete"` means only using data that has no missing value
```{r}
cor(elev$temp, elev$wind.sp, use="complete")
cor(elev$temp, elev$hour, use="complete")
cor(elev$wind.sp, elev$day, use="complete")
cor(elev$wind.sp, elev$hour, use="complete")
cor(elev$temp, elev$day, use="complete")
```

## Step 7: Exploratory graphs
Look at the distributions of all of the key variables
```{r}
hist(met$elev, breaks=100)
hist(met$temp)
hist(met$wind.sp)
```

Look at where the weather station with highest elevation is located. -> close to Denver, Colorado
```{r}
library(leaflet)
leaflet(elev) %>%
  addProviderTiles('OpenStreetMap') %>% 
  addCircles(lat=~lat,lng=~lon, opacity=1, fillOpacity=1, radius=100)
```

Look at the time series of temperature and wind speed at this location. 
```{r}
library(lubridate)
elev$date <- with(elev, ymd_h(paste(year, month, day, hour, sep= ' ')))
summary(elev$date)
elev <- elev[order(elev$date), ]
head(elev)
```
Plot the time series of temperature and wind speed.
```{r}
plot(elev$date, elev$temp, type='l')
plot(elev$date, elev$wind.sp, type='l')
```
For Temperature time series plot:
- There is a regular pattern of temperature during summer, ranging from -3 to 15°C.

For Wind Speed time series plot:
- The pattern is more irregular compared to the temperature plot, ranging from 0 to ~20 m/s.
- We should look into the periods between Aug 15–19 and Aug 20–26, which show higher wind speeds.

## Step 8: Ask more questions
Some other useful plotting functions include: - pairs for making all pairwise scatter plots in a dataset with >2 dimensions. - heatmap and/or corrplot (from the corrplot package) for visualizing matrices in general or correlation matrices in particular. - image a low-level matrix visualization function - barplot, especially with table, for visualizing frequencies of categorical variables.

```{r}
library(corrplot)

corr_df <- met[, c("elev", "temp", "wind.sp")]
corr_mat <- cor(corr_df, use = "complete.obs")

corrplot(corr_mat, method = "color", type = "upper", addCoef.col = "black",
         tl.col = "black", tl.srt = 45)
```


I wanted to explore how wind speed and temperature are influenced by elevation. Intuitively, I expect higher elevations to correspond to lower temperatures. However, the correlation between elevation and temperature is relatively weak (-0.20), suggesting that other factors may also play an important role in determining temperature patterns.